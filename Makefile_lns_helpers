# Makefile to build the helpers-only crude LNS solver

CXX := g++
CXXFLAGS := -std=gnu++17 -O2 -pthread -D__STDC_FORMAT_MACROS -fpermissive

# Prevent make from deleting these required sources as intermediates
.PRECIOUS: minisat/minisat-master/minisat/core/Solver.cc minisat/minisat-master/minisat/utils/System.cc probSAT-master/probSAT_inmem.c

INCLUDES := \
  -I. \
  -I./minisat \
  -I./minisat/minisat-master \
  -I./cnf \
  -I./mdd \
  -I./lns \
  -I./probSAT-master

SRCS := \
  lns/main_crude_lns.cpp \
  lns/LNSSolver_more_helpers.cpp \
  lns/LNSGeometry.cpp \
  lns/LNSProblemIO.cpp \
  SATSolverManager.cpp \
  cnf/CNF.cpp \
  cnf/CNFConstructor.cpp \
  cnf/CNFProbSATConstructor.cpp \
  mdd/MDD.cpp \
  mdd/MDDNode.cpp \
  mdd/MDDConstructor.cpp \
  minisat/minisat-wrapper.cpp \
  minisat/minisat-master/minisat/core/Solver.cc \
  minisat/minisat-master/minisat/utils/System.cc \
  probSAT-master/probSAT_inmem.c

# Build object files for all C/C++ sources and link only objects to avoid duplicates
OBJS := $(patsubst %.cpp,%.o,$(patsubst %.cc,%.o,$(patsubst %.c,%.o,$(SRCS))))

# Non-C++ sources to be compiled on the final link step
CC_SRCS := $(filter %.cc,$(SRCS))
C_SRCS  := $(filter %.c,$(SRCS))

TARGET := main_crude_lns_helpers

.PHONY: all clean run

all: $(TARGET)

$(TARGET): $(OBJS)
	$(CXX) $(CXXFLAGS) $(INCLUDES) $(OBJS) -o $@

%.o: %.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

%.o: %.cc
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

%.o: %.c
	$(CC) -O2 -D__STDC_FORMAT_MACROS -I. -I./probSAT-master -c $< -o $@

run: $(TARGET)
	./$(TARGET) mapf-map/maze-32-32-2.map mapf-scen-even/scen-even/maze-32-32-2-even-1.scen 3 0 minisat 42

clean:
	rm -f $(OBJS) $(TARGET)

